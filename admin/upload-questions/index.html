<!-- https://formbuilder.readthedocs.io/en/latest/formBuilder/options/disabledActionButtons/ -->
<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./index.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="../../config.js"></script>

    <style type="text/css">
        @keyframes ldio-pnlcja3k6de {
            0% {
                transform: rotate(0)
            }

            100% {
                transform: rotate(360deg)
            }
        }

        #loading {
            display: none;
        }

        .ldio-pnlcja3k6de div {
            box-sizing: border-box !important;
        }

        .ldio-pnlcja3k6de>div {
            position: absolute;
            width: 61.2px;
            height: 61.2px;
            top: 45.9px;
            left: 45.9px;
            border-radius: 50%;
            border: 6.12px solid #000;
            border-color: #fe718d transparent #fe718d transparent;
            animation: ldio-pnlcja3k6de 1s linear infinite;
        }

        .ldio-pnlcja3k6de>div:nth-child(2) {
            border-color: transparent
        }

        .ldio-pnlcja3k6de>div:nth-child(2) div {
            position: absolute;
            width: 100%;
            height: 100%;
            transform: rotate(45deg);
        }

        .ldio-pnlcja3k6de>div:nth-child(2) div:before,
        .ldio-pnlcja3k6de>div:nth-child(2) div:after {
            content: "";
            display: block;
            position: absolute;
            width: 6.12px;
            height: 6.12px;
            top: -6.12px;
            left: 21.42px;
            background: #fe718d;
            border-radius: 50%;
            box-shadow: 0 55.08px 0 0 #fe718d;
        }

        .ldio-pnlcja3k6de>div:nth-child(2) div:after {
            left: -6.12px;
            top: 21.42px;
            box-shadow: 55.08px 0 0 0 #fe718d;
        }

        .loadingio-spinner-dual-ring-a8gzc3ceux4 {
            width: 153px;
            height: 153px;
            display: inline-block;
            overflow: hidden;
        }

        .ldio-pnlcja3k6de {
            width: 100%;
            height: 100%;
            position: relative;
            transform: translateZ(0) scale(1);
            backface-visibility: hidden;
            transform-origin: 0 0;
            /* see note above */
        }

        .ldio-pnlcja3k6de div {
            box-sizing: content-box;
        }

        /* generated by https://loading.io/ */
    </style>
</head>

<body onload="_funcFetchCategories()">
    <div class="container" id="containerCategory">
        <h1 class="header">Category</h1>
        <label id="error-label" class="details-box">Please select or create an category</label>
        <div class="center">
            <select name="sources" id="category-select" class="category-select custom-select sources"
                placeholder="Choose">
                <option value="select" selected disabled>--Select--</option>

            </select>
            <div class="or">
                Or
            </div>

            <div class="input-box">
                <label class="input-label">Create</label>
                <input type="text" class="input-1" id="input-create-category" value="" onfocus="setFocus(true)"
                    onblur="setFocus(false)" />
            </div>



            <div class="clear"></div>
            <div class="next">
                <button type="button" class="btn btn-primary" onclick="handleCategory()">Next</button>
                <!-- <button type="button" class="btn btn-primary" onclick="next()">Jump</button> -->
            </div>
        </div>
    </div>
    <div class="center">
        <div class="loadingio-spinner-dual-ring-a8gzc3ceux4" id="loading">
            <div class="ldio-pnlcja3k6de">
                <div></div>
                <div>
                    <div></div>
                </div>
            </div>
        </div>

    </div>
    <div id="build-wrap"></div>
    <div id="buttons-form" class="new-action-buttons">
        <!-- <button id="show-data">Show Data</button>
        <button id="trash">Trash
            all
            fields</button> -->
        <button id="saveData">save</button>
    </div>

    <!-- SUCCESS/FAILURE -->

    <div id="success-failure" class="background"></div>
    <div class="container" id="success-failure-grid">
        <div class="row">
            <div class="modalbox success col-sm-8 col-md-6 col-lg-5 center animate">
                <div class="icon">
                    <span class="glyphicon glyphicon-ok"></span>
                </div>
                <!--/.icon-->
                <h1>Success!</h1>
                <p>Uploaded the questions successfully
                    <!-- <br>for verification.</p> -->
                    <button type="button" onClick='window.location.pathname="/admin"' class="redo btn">Back</button>
                    <button type="button" class="redo btn" onClick='window.location.pathname="/"'>Ok</button>
                    <span class="change">-- Click to see opposite state --</span>
            </div>
            <!--/.success-->
        </div>
        <!--/.row-->
        <div class="row">
            <div class="modalbox error col-sm-8 col-md-6 col-lg-5 center animate" style="display: none;">
                <div class="icon">
                    <span class="glyphicon glyphicon-thumbs-down"></span>
                </div>
                <!--/.icon-->
                <h1>Oh no!</h1>
                <p>Oops! Something went wrong,
                    <br> you should try again.</p>
                <button type="button" class="redo btn">Try again</button>
                <span class="change">-- Click to see opposite state --</span>
            </div>
            <!--/.success-->
        </div>
        <!--/.row-->
    </div>
    <!--/.container-->

    <!--  -->



    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
    <script src="https://formbuilder.online/assets/js/form-builder.min.js"></script>
    <script>
        jQuery(function ($) {
            var fbEditor = document.getElementById('build-wrap'),
                // trash = document.getElementById('trash'),
                // showData = document.getElementById('show-data'),
                saveData = document.getElementById("saveData"),
                fbOptions = {
                    showActionButtons: false,
                    disableFields: [
                        'autocomplete',
                        'paragraph',
                        'button',
                        'header',
                        'hidden',
                        'paragraph',
                        'starRating',
                        'checkbox-group',
                        'select'
                    ],
                    disabledAttrs: ["className", "inline", "toggle", "access", "name", "other", "helpetext"],
                    disabledSubtypes: {
                        textarea: ['tinymce', 'quill'],
                        text: ['color', 'password'],
                        // fileUpload:['File Uploader']
                    },
                    editOnAdd: true
                },
                formBuilder = $(fbEditor).formBuilder(fbOptions);

            // showData.onclick = function () {
            //     formBuilder.actions.showData();
            // };
            // trash.onclick = function () {
            //     formBuilder.actions.clearFields()
            // };
            saveData.onclick = function () {
                console.log("external save clicked");
                const result = formBuilder.actions.getData();

                debugger
                if (result.length === 0) {
                    alert('No questions created')
                    return false
                }

                let _localStorage = JSON.parse(localStorage.getItem('category'))
                let body = {
                    category_id: _localStorage._id,
                    questions: result
                }
                fetch(`${Api}api/createquestionsanswers`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json;charset=utf-8'
                    },
                    body: JSON.stringify(body)
                })
                    .then(response => response.json())
                    .then(commits => {
                        let _result = JSON.stringify(commits)
                        console.log(_result, "__result__")
                        document.getElementById('buttons-form').style.display = "none"
                        document.getElementById('build-wrap').style.display = "none"
                        document.getElementById('success-failure-grid').style.display = "block"
                        document.getElementById('success-failure').style.display = "block"

                    });
                console.log("result:", result);
            }
        });

    </script>
</body>
<!-- ON LOAD -->

<script>
    //  $(document).ready(function(){
    // // your code
    // _funcFetchCategories()
    // });
    const _funcFetchCategories = async () => {
        // $('#category-select').append(`<option value="${'optionValue'}"> 
        //                                    ${'optionText'} 
        //                               </option>`); 
        let _selectValue = document.getElementById('category-select')

        let body = { view_categories: true }
        await fetch(`${Api}api/createcategories`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json;charset=utf-8'
            },
            body: JSON.stringify(body)
        })
            .then(response => response.json())
            .then(async commits => {
                console.log(commits, "commits")
                if (await commits) {
                    return new Promise(async (resolve, reject) => {
                        const calls = commits.map((val) => {
                            $('#category-select').append(`<option value="${val._id}"> 
                                          ${val.type} 
                                     </option>`);
                        })
                        Promise.all(calls)
                            .then((data) => {
                                $(".custom-select").each(function () {
                                    debugger
                                    var classes = $(this).attr("class"),
                                        id = $(this).attr("id"),
                                        name = $(this).attr("name");
                                    var template = '<div class="' + classes + '">';
                                    template += '<span class="custom-select-trigger">' + $(this).attr("placeholder") + '</span>';
                                    template += '<div class="custom-options" style="height:285px;overflow:auto">';
                                    $(this).find("option").each(function () {
                                        template += '<span class="custom-option ' + $(this).attr("class") + '" data-value="' + $(this).attr("value") + '">' + $(this).html() + '</span>';
                                    });
                                    template += '</div></div>';

                                    $(this).wrap('<div class="custom-select-wrapper"></div>');
                                    $(this).hide();
                                    $(this).after(template);
                                });
                                $(".custom-option:first-of-type").hover(function () {
                                    $(this).parents(".custom-options").addClass("option-hover");
                                }, function () {
                                    $(this).parents(".custom-options").removeClass("option-hover");
                                });
                                $(".custom-select-trigger").on("click", function () {
                                    $('html').one('click', function () {
                                        $(".custom-select").removeClass("opened");
                                    });
                                    $(this).parents(".custom-select").toggleClass("opened");
                                    event.stopPropagation();
                                });
                                $(".custom-option").on("click", function () {
                                    $(this).parents(".custom-select-wrapper").find("select").val($(this).data("value"));
                                    $(this).parents(".custom-options").find(".custom-option").removeClass("selection");
                                    $(this).addClass("selection");
                                    $(this).parents(".custom-select").removeClass("opened");
                                    $(this).parents(".custom-select").find(".custom-select-trigger").text($(this).text());
                                });
                                resolve(data);
                            })
                            .catch((err) => {
                                console.log(err);
                            });
                    });
                    debugger


                }
            });


    }

    //    document.getElementById("body").addEventListener("load", _funcFetchCategories);



</script>
<script>
    var counter = 1;
    function setFocus(on) {
        var element = document.activeElement;
        if (on) {
            setTimeout(function () {
                element.parentNode.classList.add("focus");
            });
        } else {
            let box = document.querySelector(".input-box");
            box.classList.remove("focus");
            $("input").each(function () {
                var $input = $(this);
                var $parent = $input.closest(".input-box");
                if ($input.val()) $parent.addClass("focus");
                else $parent.removeClass("focus");
            });
        }
    }



    // Redirect to questions view

    const next = () => {
        document.getElementById('loading').style.display = "none"
        document.getElementById('containerCategory').style.display = "none"
        document.getElementById('build-wrap').style.display = "block"
        document.body.style.background = "whitesmoke"
        // document.getElementById('show-data').style.display = "block"
        // document.getElementById('trash').style.display = "block"
        document.getElementById('saveData').style.display = "block"
    }


    // Handle category

    const handleCategory = () => {


        let _inputCreateValue = document.getElementById('input-create-category').value
        let _selectValue = document.getElementById('category-select').value

        let _errorLabel = document.getElementById('error-label')

        // let _selectedValue = _selectValue.options[e.selectedIndex].value;
        // alert(_selectValue)
        if ((_selectValue && (_selectValue !== 'select' && _inputCreateValue)) && _inputCreateValue) {
            _errorLabel.innerHTML = "Category selected and created."
            _errorLabel.style.display = "block"
            _errorLabel.classList.add("details-box");
            setTimeout(() => { _errorLabel.classList.remove("details-box") }, 1000)
            // _errorLabel.classList.add("details-box");
            return false;
        }
        else if ((_selectValue && ((_selectValue === 'select' && _inputCreateValue) || _selectValue !== 'select')) || _inputCreateValue) {
            // alert("okay")
            // success
            _errorLabel.style.display = "none"
            document.getElementById('loading').style.display = "block"
            let body = _selectValue && _selectValue !== 'select' ? { "category_id": _selectValue } : { "category": _inputCreateValue }
            fetch(`${Api}api/createcategories`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json;charset=utf-8'
                },
                body: JSON.stringify(body)
            })
                .then(response => response.json())
                .then(commits => {
                    let _result = JSON.stringify(commits)
                    localStorage.setItem('category', _result)
                });

        }

        else {
            _errorLabel.style.display = "block"
            _errorLabel.innerHTML = "Please select or create an category."
            _errorLabel.classList.add("details-box");
            setTimeout(() => { _errorLabel.classList.remove("details-box") }, 1000)
            // _errorLabel.classList.add("details-box");
            return false;
        }
        next()

    }


    // SELECT




    // const handleClear = () =>{
    //     alert('f')
    //     document.getElementById('input-create-category').value=""
    // }

    // Add questions

    var limit = 20;
    function addInput(divName) {
        if (counter == limit) {
            alert("You have reached the limit of adding " + counter + " inputs");
        }
        else {
            var newdiv = document.createElement('div');
            newdiv.innerHTML = `<div class="input-box"><label class="input-label">${'Question ' + (counter + 1)}</label>            <input type="text" value='' id=${'input-' + (counter + 1)} class="input-1" onfocus="setFocus(true)" onblur="setFocus(false)" /></div>`;
            document.getElementById(divName).appendChild(newdiv);
            counter++;
        }
    }

    const handleSubmit = async (e) => {

        let _arr = []
        for (i = 1; i <= counter; i++) {
            let _errorLabel = document.getElementById('error-label2')
            if (!document.getElementById(`input-${i}`).value || document.getElementById(`input-${i}`).value === '') {
                //     _errorLabel.style.display = "block" 
                // _errorLabel.innerHTML = `Please don't leave Question ${i} empty.`
                // _errorLabel.classList.add("details-box");
                // setTimeout(()=>{_errorLabel.classList.remove("details-box")},1000)
                // return false
            }
            else {
                _errorLabel.style.display = "none"
            }
            _arr.push(document.getElementById(`input-${i}`).value)
        }
        // let response = await fetch('/article/formdata/post/user-avatar', {
        //   method: 'POST',
        //   body: new FormData(formElem)
        // });

        // let result = await response.json();

    };
</script>

</html>